<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Falling Parts Clock - Level 4</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

        :root {
            --bg-color: #0f0f12;
            --seg-on: #00ffcc; /* Cyan Neon */
            --seg-off: #1a1a20;
            --debris-color: #008866; /* Slightly darker/solid version for debris */
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            background-image: linear-gradient(to bottom, #0f0f12, #1b1b22);
            font-family: 'Share Tech Mono', monospace;
            overflow: hidden;
            user-select: none;
        }

        /* Container */
        .clock-container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 50px;
            width: 100%;
            max-width: 800px;
        }

        /* Rows */
        .top-row {
            display: flex;
            gap: 60px;
            justify-content: center;
            align-items: flex-end;
        }
        
        .bottom-row {
            display: flex;
            justify-content: center;
        }

        .digit-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .group-label {
            font-size: 1rem;
            color: #555;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 20px;
        }
        .digits-wrapper {
            display: flex;
            gap: 20px;
            direction: ltr; 
        }

        /* 7-Segment Digits */
        .digit {
            position: relative;
            width: 60px;
            height: 100px;
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        
        /* Level 4 Sizing */
        .top-row .digit { width: 50px; height: 90px; }
        .bottom-row .digit { width: 120px; height: 200px; } /* Big Hours */

        .segment {
            position: absolute;
            background: var(--seg-off);
            border-radius: 4px;
            transition: background 0.1s;
        }

        .segment.on {
            background: var(--seg-on);
            box-shadow: 0 0 10px var(--seg-on);
            z-index: 2;
        }

        /* Segment Positions */
        /* Standard h/v split */
        .segment.h { height: 12%; left: 15%; right: 15%; margin-top:-6%; }
        .segment.v { width: 12%; height: 35%; margin-left:-6%; }
        
        .segment.a { top: 0; margin-top:0; }
        .segment.g { top: 50%; }
        .segment.d { bottom: 0; margin-top:0; margin-bottom:0; }
        
        .segment.f { top: 5%; left: 0; margin-left:0; }
        .segment.b { top: 5%; right: 0; margin-left:0; }
        .segment.e { bottom: 5%; left: 0; margin-left:0; }
        .segment.c { bottom: 5%; right: 0; margin-left:0; }

        /* Debris Container */
        #debris-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        .debris {
            position: absolute;
            background: var(--debris-color);
            box-shadow: 0 0 5px var(--debris-color);
            opacity: 1; /* Start visible */
            border-radius: 4px;
            /* Will be animated via JS */
        }
        
        /* Fade out class */
        .fading {
            transition: opacity 1s ease-out;
            opacity: 0;
        }

        /* Settings Button */
        .config-btn {
            position: absolute;
            top: 20px; right: 20px;
            font-size: 1.5rem;
            background: rgba(255,255,255,0.1);
            color: #ccc;
            border: 1px solid #555;
            width: 50px; height: 50px;
            cursor: pointer;
            z-index: 200;
            border-radius: 5px;
        }
        .config-btn:hover { background: rgba(255,255,255,0.2); }

         /* Modal */
        .modal {
            position: fixed;
            top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
            z-index: 500;
        }
        .modal.open { opacity: 1; pointer-events: all; }

        .panel {
            background: #222;
            border: 1px solid #444;
            padding: 30px;
            width: 300px;
            color: #eee;
        }
        .panel h2 { margin-top:0; border-bottom:1px solid #444; padding-bottom:10px; }
        
        .option-row { margin: 15px 0; display:flex; justify-content:space-between; align-items:center; }
        
        input[type=range] { width: 100px; }

    </style>
</head>
<body>

    <button class="config-btn" id="openSettings">⚙️</button>

    <div id="debris-layer"></div>

    <div class="clock-container">
        
        <!-- Top Row -->
        <div class="top-row">
            <div class="digit-group">
                <div class="group-label">MINUTES</div>
                <div class="digits-wrapper">
                    <div class="digit" id="min-1"></div>
                    <div class="digit" id="min-2"></div>
                </div>
            </div>
            
            <div class="digit-group">
                <div class="group-label">SECONDS</div>
                <div class="digits-wrapper">
                    <div class="digit" id="sec-1"></div>
                    <div class="digit" id="sec-2"></div>
                </div>
            </div>
        </div>

        <!-- Bottom Row -->
        <div class="bottom-row">
            <div class="digit-group">
                <div class="group-label">HOURS</div>
                <div class="digits-wrapper">
                    <div class="digit" id="hour-1"></div>
                    <div class="digit" id="hour-2"></div>
                </div>
            </div>
        </div>

    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="panel">
            <h2>PHYSICS CONFIG</h2>
            <div class="option-row">
                <label>Gravity</label>
                <input type="range" id="gravityRange" min="0.1" max="1.0" step="0.1" value="0.5">
            </div>
            <div class="option-row">
                <label>Bounciness</label>
                <input type="range" id="bounceRange" min="0.1" max="0.9" step="0.1" value="0.4">
            </div>
            <div class="option-row">
                <label>Neon Color</label>
                <input type="color" id="colorPicker" value="#00ffcc">
            </div>
            <button onclick="document.getElementById('modal').classList.remove('open')" style="width:100%; padding:10px; background:#444; color:#fff; border:none; margin-top:10px; cursor:pointer;">CLOSE</button>
        </div>
    </div>

    <script>
        // 7-Segment Logic
        const digitSegments = {
            0: ['a', 'b', 'c', 'd', 'e', 'f'],
            1: ['b', 'c'],
            2: ['a', 'b', 'd', 'e', 'g'],
            3: ['a', 'b', 'c', 'd', 'g'],
            4: ['b', 'c', 'f', 'g'],
            5: ['a', 'c', 'd', 'f', 'g'],
            6: ['a', 'c', 'd', 'e', 'f', 'g'],
            7: ['a', 'b', 'c'],
            8: ['a', 'b', 'c', 'd', 'e', 'f', 'g'],
            9: ['a', 'b', 'c', 'd', 'f', 'g']
        };
        const segmentClasses = ['a', 'b', 'c', 'd', 'e', 'f', 'g'];

        // Init Segments
        function createSegments(elementId) {
            const digitEl = document.getElementById(elementId);
            segmentClasses.forEach(seg => {
                const div = document.createElement('div');
                div.classList.add('segment', seg);
                if (['a', 'g', 'd'].includes(seg)) div.classList.add('h');
                else div.classList.add('v');
                digitEl.appendChild(div);
            });
        }
        
        ['min-1','min-2','sec-1','sec-2','hour-1','hour-2'].forEach(createSegments);

        // Previous State Tracker (to detect OFF transition)
        // Store simple Set of active segments per digit last frame
        const prevActive = {};

        function getActive(val) {
            return new Set(digitSegments[val] || []);
        }

        // DEBRIS SYSTEM
        const debrisLayer = document.getElementById('debris-layer');
        const activeDebris = []; // List of objects {el, x, y, vx, vy, rot, vRot, life}

        // Physics Params
        let GRAVITY = 0.5;
        let BOUNCE = 0.4;
        const GROUND_Y = window.innerHeight; // Ground level

        function spawnDebris(sourceRect, colorClass) {
            const d = document.createElement('div');
            d.classList.add('debris');
            d.classList.add(colorClass); // reuse segment class for basic shape ? Actually we need explicit styling based on sourceRect
            
            // Set initial style matching the source
            d.style.width = sourceRect.width + 'px';
            d.style.height = sourceRect.height + 'px';
            d.style.left = '0px'; 
            d.style.top = '0px';
            d.style.borderRadius = '4px';
            // Ensure color is consistent with current setting if not automatic
            // It uses var(--debris-color) from CSS, which we update globally
            
            debrisLayer.appendChild(d);

            // Add to physics list
            activeDebris.push({
                el: d,
                x: sourceRect.left,
                y: sourceRect.top,
                vx: (Math.random() - 0.5) * 10, // Random Horizontal burst
                vy: (Math.random() * -5) - 2,  // Slight upward pop before fall
                rot: 0,
                vRot: (Math.random() - 0.5) * 20, // Spin
                life: 7000, // 7 seconds (ms) before fade start
                fading: false
            });
        }

        function updatePhysics() {
            const dt = 16.6; // ~60fps
            
            for (let i = activeDebris.length - 1; i >= 0; i--) {
                let p = activeDebris[i];
                
                // Life timer
                if(p.life > 0) {
                    p.life -= dt;
                } else if(!p.fading) {
                    // Start fade
                    p.fading = true;
                    p.el.classList.add('fading');
                    // Remove form DOM after 1s (css transition)
                    setTimeout(() => {
                        if(p.el && p.el.parentNode) p.el.parentNode.removeChild(p.el);
                    }, 1000);
                    // Remove from array immediately to stop physics calc
                    activeDebris.splice(i, 1);
                    continue;
                }

                // Apply Gravity
                p.vy += GRAVITY;
                
                // Move
                p.x += p.vx;
                p.y += p.vy;
                p.rot += p.vRot;

                // Floor Collision
                if(p.y + parseFloat(p.el.style.height) > window.innerHeight) {
                    p.y = window.innerHeight - parseFloat(p.el.style.height);
                    p.vy *= -BOUNCE;
                    p.vx *= 0.8; // Friction
                    p.vRot *= 0.8; // Spin friction
                    
                    // Stop jitter
                    if(Math.abs(p.vy) < GRAVITY * 2) p.vy = 0;
                }

                // Walls collision (optional, keep them on screen)
                if(p.x < 0) { p.x = 0; p.vx *= -BOUNCE; }
                if(p.x > window.innerWidth) { p.x = window.innerWidth; p.vx *= -BOUNCE; }

                // Update DOM
                p.el.style.transform = `translate(${p.x}px, ${p.y}px) rotate(${p.rot}deg)`;
            }

            requestAnimationFrame(updatePhysics);
        }
        updatePhysics(); // Start Loop

        function updateDigit(elementId, value) {
            const digitEl = document.getElementById(elementId);
            const activeSegments = digitSegments[value] || [];
            
            const prevSet = prevActive[elementId] || new Set();
            const currentSet = new Set(activeSegments);

            // Check segments
            Array.from(digitEl.children).forEach(segDiv => {
                const segClass = segDiv.classList[1]; 
                const isOn = currentSet.has(segClass);
                const wasOn = prevSet.has(segClass);

                if (isOn) {
                    if (!wasOn) segDiv.classList.add('on');
                } else {
                    if (wasOn) {
                        // Turning OFF -> Spawn Debris
                        const rect = segDiv.getBoundingClientRect();
                        spawnDebris(rect, 'h'); // type doesn't matter much for class logic here, style handled manually
                        segDiv.classList.remove('on');
                    }
                }
            });

            prevActive[elementId] = currentSet;
        }

        function updateClock() {
            const now = new Date();
            const h = now.getHours().toString().padStart(2, '0');
            const m = now.getMinutes().toString().padStart(2, '0');
            const s = now.getSeconds().toString().padStart(2, '0');

            updateDigit('hour-1', parseInt(h[0]));
            updateDigit('hour-2', parseInt(h[1]));
            updateDigit('min-1', parseInt(m[0]));
            updateDigit('min-2', parseInt(m[1]));
            updateDigit('sec-1', parseInt(s[0]));
            updateDigit('sec-2', parseInt(s[1]));
        }

        setInterval(updateClock, 1000);
        
        // Initial draw (without spawning debris)
        // We can just run it, debris spawns only on TRANSITION from ON to OFF.
        // On first run, prevSet is empty, so everything turns ON (no debris).
        updateClock();


        // Config
        const root = document.querySelector(':root');
        const gRange = document.getElementById('gravityRange');
        const bRange = document.getElementById('bounceRange');
        const cPicker = document.getElementById('colorPicker');

        gRange.oninput = (e) => GRAVITY = parseFloat(e.target.value);
        bRange.oninput = (e) => BOUNCE = parseFloat(e.target.value);
        cPicker.oninput = (e) => {
            const color = e.target.value;
            root.style.setProperty('--seg-on', color);
            // Derive simpler debris color (same color)
            root.style.setProperty('--debris-color', color);
        };

        document.getElementById('openSettings').onclick = () => document.getElementById('modal').classList.add('open');


    </script>
</body>
</html>
