<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµØ±Ø§Ø¹ Ø§Ù„Ø£Ø¹Ù„Ø§Ù… - Flag Struggle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background-color: #0f172a; font-family: 'Cairo', sans-serif; }
        canvas { display: block; }
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .center-msg { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; pointer-events: auto;
            background: rgba(15, 23, 42, 0.95); 
            backdrop-filter: blur(10px);
            padding: 2.5rem; border-radius: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: none; flex-direction: column; gap: 1rem; align-items: center;
            min-width: 350px;
            max-width: 90%;
        }
        .qualifiers {
            position: absolute; top: 10px; right: 10px; right: 10px; 
            background: rgba(15, 23, 42, 0.8); padding: 10px; border-radius: 8px;
            display: flex; flex-direction: column; gap: 5px; max-height: 80vh; overflow-y: auto;
            border: 1px solid #334155; width: 140px;
        }
        .qualifier-item {
            display: flex; align-items: center; gap: 8px;
            background: rgba(30, 41, 59, 0.8); padding: 4px 8px; border-radius: 4px;
            font-size: 12px; color: #cbd5e1;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .main-title {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            text-align: center; z-index: 10; pointer-events: none; width: 100%;
        }
        /* Stage 4: Top Bar Message */
        .stage4-wait-msg {
            position: absolute; top: 15%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 40px;
            border-radius: 30px;
            color: #fbbf24;
            display: none; /* Controlled by JS or CSS classes if needed, here we use canvas */
        }
    </style>
</head>
<body>

    <!-- UI Elements -->
    <div class="main-title">
        <h1 id="main-title" class="text-2xl font-black text-yellow-500 tracking-wider">Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø³Ù‚ÙˆØ·</h1>
        <p id="sub-title" class="text-sm text-slate-400 mt-1">Ø£ÙˆÙ„ 10 Ø£Ø¹Ù„Ø§Ù… ØªØµÙ„ Ù„Ù„Ù†Ù‡Ø§ÙŠØ© ØªØªØ£Ù‡Ù„!</p>
    </div>

    <!-- Qualifiers Side Panel -->
    <div id="qualifiers-container" class="qualifiers">
        <!-- populated by js -->
    </div>

    <!-- Dev Controls (Hidden for players) -->
    <div style="position: absolute; bottom: 10px; left: 10px; pointer-events: auto;" class="flex gap-2 opacity-30 hover:opacity-100 transition-opacity">
        <button onclick="devJump(1)" class="bg-slate-700 text-white px-2 py-1 text-xs rounded">S1</button>
        <button onclick="devJump(2)" class="bg-slate-700 text-white px-2 py-1 text-xs rounded">S2</button>
        <button onclick="devJump(3)" class="bg-slate-700 text-white px-2 py-1 text-xs rounded">S3</button>
        <button onclick="devJump(4)" class="bg-slate-700 text-white px-2 py-1 text-xs rounded">S4</button>
        <button onclick="devJump(5)" class="bg-slate-700 text-white px-2 py-1 text-xs rounded">S5</button>
    </div>

    <!-- Results Modal -->
    <div id="stage-results-ui" class="center-msg">
        <div class="mb-4">
            <div id="loser-display" class="flex flex-col items-center">
                <span id="loser-emoji" class="text-7xl mb-2"></span>
                <span class="text-red-400 font-bold tracking-widest text-sm uppercase">ØºØ§Ø¯Ø± Ø§Ù„Ø³Ø¨Ø§Ù‚</span>
                <span id="loser-name" class="text-2xl text-white font-black mt-1"></span>
            </div>
        </div>
        
        <div class="w-full bg-slate-700 h-px my-2"></div>
        
        <h3 class="text-yellow-400 font-bold mb-2">Ø§Ù„Ù…ØªØ£Ù‡Ù„ÙˆÙ† (<span id="qualifiers-count"></span>)</h3>
        <div id="qualifiers-grid" class="grid grid-cols-5 gap-2 w-full"></div>
        
        <button id="next-stage-btn" class="mt-6 bg-green-600 hover:bg-green-500 text-white px-8 py-2 rounded-full font-bold transition-all transform hover:scale-105">
            Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© <span id="btn-timer">(10)</span>
        </button>
    </div>

    <!-- Winner Modal -->
    <div id="winner-ui" class="center-msg" style="border-color: #eab308; background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(88, 28, 135, 0.98)); border-width: 2px;">
        <h1 class="text-5xl font-black text-yellow-400 mb-4 drop-shadow-lg">ðŸ‘‘ Ø§Ù„Ø¨Ø·Ù„ ðŸ‘‘</h1>
        <div class="text-[120px] mb-4" id="winner-emoji"></div>
        <h2 class="text-4xl text-white font-black" id="winner-name"></h2>
        <p class="text-slate-300 mt-2 text-lg">ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ø²ÙŠÙ…Ø© Ø§Ù„ØªÙŠ Ù„Ø§ ØªÙ„ÙŠÙ†!</p>
        <button onclick="location.reload()" class="mt-8 bg-yellow-500 hover:bg-yellow-400 text-slate-900 px-8 py-3 rounded-xl font-black text-xl transition-all">
            Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ðŸ”„
        </button>
    </div>

    <canvas id="game-canvas"></canvas>

    <!-- Game Scripts -->
    <script src="js/main.js"></script>
    <script src="js/stage1.js"></script>
    <script src="js/stage2.js"></script>
    <script src="js/stage3.js"></script>
    <script src="js/stage4.js"></script>
    <script src="js/stage5.js"></script>

</body>
</html>
